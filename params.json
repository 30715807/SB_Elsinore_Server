{"name":"StrangeBrew Elsinore","tagline":"Java Brewery & Fermentation Controller","body":"# Welcome To StrangeBrew Elsinore\r\n\r\nWhen I started this project in 2013 (well, really in 2012, but the first commit was March 2013), I had a simple idea of just have a PID controller written in Java serving a lightweight web page that could be accessed on any device for a RaspberryPi to be used as a lightweight server. \r\n\r\nThis light idea, quickly ballooned, resulting in a slow performing system, used by a lot of people, with [products](http://brewtronix.com/Hosehead) being made on top of it (no, I do not get any money from this).\r\n\r\nI originally wanted it to be a tech playground for me outside of my day job. So sometimes changes can come thick and fast, but sometimes can be exceptionally slow, especially if I've had a bad week.\r\n\r\n## Features\r\n\r\n* Proportional Integral Differential Temperature Control\r\n* Manual Duty Output Control\r\n* Hysteresis Output Control (think fridges, gas controllers, etc...)\r\n* Live Data Graphing (with downloadable content for analysis)\r\n* Manual Switch Controls\r\n* Timers\r\n* Volume Sensing\r\n* pH Sensors (SEN0161)\r\n* Trigger Controls\r\n* Load Mash Steps from BeerXML\r\n* One Wire Temperature Probes (through kernel w1 module, and OWFS)\r\n* Various Analogue Inputs (DS2450, ADS1015, ADS1115, Beaglebone onboard)\r\n* Web UI Updates\r\n* Responsive Bootstrap Web Interface\r\n\r\n## Setting Up The Hardware\r\n\r\nThis may vary slightly depending on your hardware, but the general steps are\r\n\r\n1.  Setup a OneWire host (normally this just needs a 4k7 ohm resistor)\r\n2.  Connect any SSRs to GPIOs on the host board\r\n3.  Clone this repository\r\n4.  Launch Elsinore\r\n5.  Setup temperature probes\r\n6.  Setup PIDs\r\n7.  Setup Switches, Timers, pH Sensors, etc...\r\n8.  Get Brewing!\r\n\r\n## Detailed RaspberryPi Setup\r\n\r\n[Set up your DS18 probes](https://www.cl.cam.ac.uk/projects/raspberrypi/tutorials/temperature/)\r\n\r\nThen run this code in the LXTerminal to automatically load the One-Wire modules on start up\r\n\r\nOpen /etc/modules to edit\r\n\r\n\tsudo nano /etc/modules\r\n\r\nAdd these lines to the bottom of the file /etc/modules\r\n\r\n\tw1-gpio\r\n\tw1-therm\r\n\r\nIf you're on a newer kernel you may need to edit your /boot/config.txt\r\n\r\n    sudo nano /boot/config.txt\r\n\r\nAdd this line\r\n\r\n    dtoverlay=w1-gpio,gpiopin=4\r\n\r\nThen reboot\r\n\r\n\tsudo reboot\r\n\r\n### Download Elsinore\r\n\r\nDownload the SB_Elsinore_Server from git\r\n\r\n\tgit clone https://github.com/DougEdey/SB_Elsinore_Server.git ~/SB_Elsinore_Server\r\n\r\nSwitch directories\r\n\r\n\tcd ~/SB_Elsinore_Server\r\n\r\nRun Elsinore\r\n\r\n\t./launch.sh\r\n\r\n### Choosing the GPIO Pins\r\nSee this [post](http://www.homebrewtalk.com/f170/raspberry-pi-strangebrew-elsinore-basic-setup-463590/index3.html#post5986888) to make sure you use the correct GPIO pins for output and you don't choose one that is in the default HIGH state when the Pi boots up!!!\r\n\r\n**It is highly recommended you setup a KILL SWITCH that will terminate the negative and/or the positive to the SSRs. This is a safety feature and allows you to kill the SSRs without going through the UI**\r\n\r\n## BeagleBone Black Setup\r\n\r\n\r\n**It is highly recommended you setup a KILL SWITCH that will terminate the negative and/or the positive to the SSRs. This is a safety feature and allows you to kill the SSRs without going through the UI**\r\n\r\nDo not use a kernel above 3.8 at the moment, you may need to install the 3.8 kernel on a newer image: ``` sudo apt-get install linux-image-3.8.13-bone67 ```\r\n\r\n\r\n### Launching\r\n\r\nYou _must_ set the \"Gpio_definitions\" property on launch \r\n\r\n``` java -Dgpio_definitions=extras/beaglebone.json -jar Elsinore.jar ```\r\n\r\nOtherwise the system will error\r\n\r\n### GPIO Naming\r\n\r\nThe Pinout number is different between RaspberryPi and Beaglebone.\r\n\r\nFor Beagleboard Black Pinout: http://elinux.org/BeagleBone#P9_and_P8_-_Each_2x23_pins\r\n\r\nBeagleboardBlack has multiple banks, for example GPIO2_2, this translates to physical pin 66, banks are separated by 32 outputs per bank. \r\n\r\n\r\n### Overlays\r\n\r\nFor beagleboard to get OneWire support, and GPIO control, you need to install a Device Tree Overlay file. I have added these under the 'extras' directory.\r\n\r\nThe dts file will show you the pin, but it's ```P8.11```\r\n\r\nTo compile the overlay: \r\n\r\n``` sudo dtc -O dtb -o /lib/firmware/w1-00A0.dtbo -b 0 -@ w1.dts ```\r\n\r\nOr copy the w1-00A0.dtbo in the support directory to /lib/firmware (as root), the above command copies the file for you.\r\n\r\nLogin as root (such as \"sudo su\") and run \r\n\r\n``` echo w1 > /sys/devices/bone_capemgr.8/slots ```\r\n\r\nNote: bone_capemgr.8 may be bone.capemgr.9 depending on your setup\r\n\r\nI have also provided a sample jGPIO created overlay for GPIO0_7 as a pinout (jgpio-00A0.dtbo) which can be used in the same was as above\r\n\r\n``` sudo cp extras/jgpio-00A0.dtbo /lib/firmware/ ```\r\n\r\n``` echo jgpio > /sys/devices/bone_capemgr.8/slots ```\r\n\r\nYou can run ``` sudo extras/bbb_setup.sh ``` to automatically initialize these two files.\r\n\r\n#### jGPIO\r\n\r\n[jGPIO](http://dougedey.github.io/jGPIO/) is a Java application I made to generate the Device Tree Overlays based on a JSON configuration file. At the time of writing this affects Linux Kernel 3.8 and above. The raspberry Pi doesn't support Kernel 3.8 yet.\r\n\r\n### Creating a custom Overlay\r\n\r\nIf you want to create a DTC file for custom GPIO pinout, you can read the instructions in the [jGPIO](https://github.com/DougEdey/jGPIO) repository\r\n\r\nBut the synopsis is\r\n\r\n``` java -cp Elsinore.jar -Dgpio_definition=extras/beaglebone.json jGPIO.DTOTest <List of GPIO pins> ```\r\n\r\nFor example\r\n\r\n``` java -cp Elsinore.jar -Dgpio_definition=extras/beaglebone.json jGPIO.DTOTest GPIO0_7 ``` \r\n\r\nWill recreate the default GPIO0_7 file as jgpio-00A0.dto.\r\n\r\n``` java -cp Elsinore.jar -Dgpio_definition=extras/beaglebone.json jGPIO.DTOTest GPIO0_7 GPIO0_8 GPIO1_12 ``` \r\n\r\nWill create a Device Tree Overlay with GPIO0_7, GPIO0_8 and GPIO1_12 for export.\r\n\r\nYou will then need to compile this as the same as above but for jgpio:\r\n\r\n``` sudo dtc -O dtb -o /lib/firmware/jgpio-00A0.dtbo -b 0 -@ jgpio-00A0.dto ```\r\n\r\nThis places the compiled file in the /lib/firmware directory.\r\n\r\nUsing ```extra/bbb_setup.sh``` will always export the jgpio overlay to the cape manager, if there is a firmware file for it.\r\n\r\n### Analogue inputs\r\n\r\nThere is already a precompiled AIN DTO for the Beaglebone Black, BB-ADC, as above:\r\n\r\n``` echo BB-ADC > /sys/devices/bone_capemgr.8/slots ```\r\n\r\nTo Activate them.\r\n\r\n## Web Interface\r\n\r\nThis is all the technical stuff for setting up Elsinore, you'll only need to do these on initial setup.\r\n\r\nNow, you can get started with the web interface.\r\n\r\n### Overview\r\n\r\n![Overview](http://i.imgur.com/y8CqUur.png)\r\n\r\nThis is an overview with a few items that I have setup already, I'll work around them\r\n\r\n### Navigation Bar\r\n  1.  Link to this repository\r\n  2.  Check for Updates -> Query the Git Server for updates, if there's an update, you'll see a message at the bottom of this navigation bar.\r\n  3.  System Configuration -> See Below\r\n  4.  Hidden Probes -> When you've hidden a temperature probe/PID from the UI, it'll appear here, you can click it to unhide it.\r\n  5.  Temperature (and duty, and pH) data. This is a live graph since you last cleared the data or started Elsinore, over time this can cause issues in the browser, so download the data to parse it locally.\r\n  6.  Recipe Details -> Upload BeerXML to be able to set the Mash Profile (Hop additions, and fermentation profile to come in the future)\r\n  7.  Github -> Link here\r\n  8.  /r/StrangeBrew -> https://www.reddit.com/r/strangebrew Go here for better updates and talking to your fellow homebrewers\r\n  9.  Homebrew Talk -> The Elsinore Thread (bloated)\r\n\r\n#### System Configuration\r\n![System Configuration](http://i.imgur.com/mUmQrmQ.png)\r\n* Restore State On Startup -> If Elsinore has triggers setup and it crashes & reboots during a run, this will resume from where it was when Elsinore starts up again\r\n* Recorder Enabled -> Record Temperature, Duty, and pH Data\r\n* Tolerance -> The difference between temperatures to record (defaults to 0.15 degrees)\r\n* Time -> The time in milliseconds to check data any data points to be recorded.\r\n* Use OWFS -> Use the OWFS server (for DS2450 probes)\r\n* Server -> OWFS Server (normally localhost)\r\n* Port -> OWFS Port (normally 4304)\r\n\r\n\r\n### Devices\r\n\r\nTo edit a device, double click on the header.\r\n\r\n#### Device Setup\r\n\r\nTemperature probes are referred to as devices. A temperature probe becomes a PID when it has a GPIO setup for heating or cooling output.\r\n\r\n![Edit Device](http://i.imgur.com/z2TxHTx.png)\r\n\r\n**General Settings**\r\nThis is the overview for the Temperature probe\r\n* Name -> The name of this probe, this can be left blank, and will default to the address of the probe.\r\n* Heat GPIO -> The GPIO used to turn on the heating output, if the \"Inverted\" button is clicked, then the GPIO will drive low to turn on the output (for instance, if it's used as a current sink).\r\n* Cool GPIO -> The GPIO used to turn on the cooling output, if the \"Inverted\" button is clicked, then the GPIO will drive low to turn on the output (for instance, if it's used as a current sink).\r\n* Aux GPIO -> This is a manual element control, if the \"Inverted\" button is clicked, then the GPIO will drive low to turn on the output (for instance, if it's used as a current sink).\r\n* Calibration -> Any Temperature offset for this probe. If it's reading 1C too high, add -1 here, if it's 1C too low, add 1 here.\r\n* Cutoff Enabled -> If selected, and the Safety value is not -999, then when the temperature is read as higher than this number, Elsinore will shutdown\r\n\r\n* Hide -> Hide this temperature probe from the UI, it will appear in the dropdown list on the Navigation bar\r\n* Add New Trigger -> Show the new trigger modal dialog\r\n* Save Changes -> Save the current values\r\n* Delete -> Delete this temperature probe from Elsinore, to restore it, you will need to restart Elsinore.\r\n\r\n**Heat/Cool Settings**\r\n\r\n![PID Settings](http://i.imgur.com/l2BoE0X.png)\r\n\r\nThese settings used to appear when you pressed the auto button, but now they have been moved here. They will only show if you have a Heat and/or Cool GPIO setup.\r\n\r\n* Cycle Time -> Time in seconds for a full cycle\r\n* Proportional \r\n* Integral\r\n* Differential\r\n\r\nFor detailed instructions on how to set this up, please refer to [Justin's Website](http://onbrewing.com/a-shiny-new-way-of-calculating-pid-parameters/)\r\n\r\n#### Adding a New Trigger\r\n\r\nNote: These will be rewritten in the future.\r\n\r\nTriggers are ways to automatically control PID set points, timers, switches, other trigger profiles and so on.\r\n\r\nA trigger profile is a sequence of triggers that are assigned to a temperature probe.\r\n\r\n![Add Trigger](http://i.imgur.com/WYbgJsO.png)\r\n\r\nThis is what you get when you press \"Add New Trigger\", all you need to do is select the trigger you want\r\n\r\n![Temperature](http://i.imgur.com/u6sdDKd.png)\r\n\r\n* Set Point -> The Set point that to set the PID to in auto mode.\r\n* End Temp -> Once the set point has been hit, aim for this temperature before moving to the next trigger.\r\n* Step Method/Type -> Free form text inputs\r\n\r\n![Profile](http://i.imgur.com/R0q8YLu.png)\r\n\r\nThe Trigger Profile to activate\r\n\r\n![Wait](http://i.imgur.com/R0q8YLu.png)\r\n\r\nWait for the specified minutes & seconds before moving to the next step.\r\n\r\nThe normal flow for this would be to add a temperature trigger, then a wait trigger, then a temperature trigger, then a wait trigger.\r\n\r\nFor example -> Temp = 154F -> Wait (60 minutes) -> Temp = 165F -> Wait (30 minutes) -> Temp = 170F.\r\n\r\n### Switches\r\n\r\nSwitches are basic on/off manually controlled outputs.\r\n\r\n#### Add/Edit Switch\r\n\r\n![Add Switch](http://i.imgur.com/zUEK4BZ.png)\r\n\r\nThis is the view you get when you add a switch by double clicking on the \"Switches\" header (this won't work on mobile). \r\n\r\n* Name => The name of the switch\r\n* GPIO => The GPIO to use for the switch\r\n* Invert => If the switch should be low for on, high for off.\r\n\r\nIf you double click a switch, this will be presented with the current switch settings in it.\r\n\r\n\r\n### Timers\r\n\r\n#### Add/Edit Timer\r\n\r\n![Timer](http://i.imgur.com/jDSLVBZ.png)\r\n\r\nThis is the view you get when you add a timer by double clicking the \"Timers\" header (this won't work on mobile).\r\n\r\n* Name => The name of the timer\r\n* Countdown? => Doesn't do anything at this point, future feature\r\n* Duration  => The amount to count up/down to (future feature)\r\n\r\nIf you edit a timer, by double clicking it, you will be shown this dialog with the settings for the switch.\r\n\r\n#### pH Sensors\r\n\r\nCurrently only the SEN0161 is supported, if you find a new pH Sensor you want support for, please let me know.\r\n\r\nWhen you double click the pH Sensors header, you will get a dialog to select the input you would like to use.\r\n\r\n* pH Sensor => The Name to use\r\n* Analogue Input type (DS2450, Onboard AIN, or I2C)\r\n* Sensor Model => The pH Sensor model, only SEN0161 is supported at the moment.\r\n* Calibrate => A value to add to the pH reading if it's not correct and consistently off.\r\n\r\n![Onboard AIN](http://i.imgur.com/N5AcDPY.png)\r\n\r\nOnboard AIN uses the onboard Beaglebone Analogue inputs, these are 1.7V  so be careful.\r\n\r\n* Analogue pin => The Raw Pin number to use.\r\n\r\n![DS2450](http://i.imgur.com/T5qU8mO.png)\r\n\r\n* DS2450 Address => The drop down shows the detected DS2450 adapters found\r\n* DS2450 Offset => The pin to use to read (A, B, C, D)\r\n\r\n![I2C Analog](http://i.imgur.com/iUN3uhG.png)\r\n\r\n* I2C Bus => Select the bus that the I2C Device is on, this will contain the detected buses.\r\n* I2C Address => The I2C Address for the chip on the bus (i.e. 0x49, 0x48)\r\n* I2C Offset => The Input pin to use (A, B, C, D)\r\n* I2C Chip => The ADC chip to use (currently supports ADS1015 and ADS1115)\r\n\r\nDouble clicking a pH Sensor will show this with an edit box.\r\n\r\nSingle clicking a pH Sensor will update the value. The default button shows the name of the pH Sensor with the last pH Value read.\r\n\r\n\r\n## How To Brew\r\n\r\nAt the most basic, Elsinore is a series of PIDs.\r\n\r\nEach PID has four \"modes\"\r\n\r\n* Off => The GPIOs are all off\r\n* Auto => The PID settings are used to get to the setpoint set in this mode.\r\n* Manual => The GPIO output will be on and off for a percentage of the cycle time. A positive number for duty cycle is for the heating GPIO, a negative number is for the Cool GPIO. i.e. 50% duty cycle for a 10s cycle time => heat GPIO is on for 5s, and off for 5s. -60% duty cycle for a 300s cycle time (5 mins), cool GPIO is on for 3 minutes, and off for two minutes.\r\n* Hysteria => The cooling GPIO will be on if the temperature is above the maximum temperature for a minimum number of minutes or until the maximum temperature is hit (whichever takes longer), then off for at least the number of minutes specified. The heating GPIO will be on if the temperature is below the minimum temperature for a minimum number of minutes or until the minimum temperature is hit (whichever takes longer).\r\n\r\nYou must hit \"Submit\" to apply the settings after pressing the button. The Web UI will update when the next status update occurs to mark the mode as active. The Duty progress will indicate the state.\r\n\r\n\r\n# Thank you\r\n\r\nThank you for using this piece of software, if you want to help fund future development please donate to me via [paypal email](doug.edey+paypal@gmail.com)","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}